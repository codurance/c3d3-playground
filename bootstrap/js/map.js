"use strict";const FINAL="https://gist.githubusercontent.com/damianpumar/862fe8d75f92a0b114ad4ae2bf128e13/raw/21dc4b07207455034b1e48022ae53f3a84fe5ece/finaltopojson",map=d3.select("#map"),filters=document.getElementById("filters");var width=map.node().getBoundingClientRect().width;width<=400&&(width+=510);const height=width/.6,COLORS=["#ffffff","#ffd333","#ffde66","#fff4cc","#ffe999"],svg=map.append("svg").attr("viewBox","0 0 "+width+" "+height).attr("preserveAspectRatio","xMinYMin"),path=d3.geoPath();var tooltip=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);function render(t){svg.selectAll("path").remove(),svg.selectAll("text").remove(),d3.json(FINAL).then(e=>{const r=topojson.feature(e,e.objects.ABS_2018).features,o=e.objects.ABS_2018.geometries.map(({properties:e})=>e.VALORES?e.VALORES[t]:0),a=d3.scaleQuantize().domain(d3.extent(o)).range(COLORS);svg.selectAll("path").data(r).enter().append("path").attr("d",path).attr("fill",e=>a(Number(e.properties.VALORES?e.properties.VALORES[t]:0))).attr("stroke","black").on("mouseover",function(t,e){d3.select(this).attr("fill","orange"),tooltip.transition().duration(200).style("opacity",.9)}).on("mousemove",function(e){tooltip.html(e.properties.NOMABS+"<br />"+e.properties.NOMAGA+"<br />"+e.properties.NOMSS+"<br />"+e.properties.VALORES[t]).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-50+"px")}).on("mouseout",function(e,r){const o=a(Number(e.properties.VALORES?e.properties.VALORES[t]:0));d3.select(this).attr("fill",o),tooltip.transition().duration(500).style("opacity",0)}),svg.selectAll("text").data(r).enter().append("text").attr("class","label").attr("font-size","10").attr("transform",t=>`translate(${path.centroid(t)})`).text(({properties:t})=>t.NOMABS.replace("Barcelona - ",""))}).catch(t=>console.error(t))}filters.addEventListener("change",function(){render(this.value)}),render(0);